#ifndef _LPTAD3DMODEL_H_
#define _LPTAD3DMODEL_H_

#include <vector>
#include <memory>
#include <d3d9.h>
#include <Windows.h>
#include "adapter/AdapterInfo.h"
using std::vector;
using std::shared_ptr;

struct LPTADEVICEINFO;
struct LPTACOMBOINFO;

class LptaD3DConfig;
typedef shared_ptr<LptaD3DConfig> LPTA_D3D_CONFIG;

class LptaD3DConfig
{
public:
	///////////////////////////////////////////////////////////////////////////
	// Singleton factory
	/////////////////////////////////////////////////////////////////
	static LPTA_D3D_CONFIG GetConfig(void);
	static LPTA_D3D_CONFIG GetConfig(const LPDIRECT3D9 d3d);

	~LptaD3DConfig(void);

	///////////////////////////////////////////////////////////////////////////
	// Accessors
	/////////////////////////////////////////////////////////////////
	const vector<D3DFORMAT> & GetFormats(void) const;

	///////////////////////////////////////////////////////////////////////////
	// User dialog methods
	/////////////////////////////////////////////////////////////////
	void ConnectTo(HWND dialog);
	void ShowUserDialog(HINSTANCE hDLL, HWND hWnd);
	BOOL CALLBACK DlgProc(HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam);
private:
	///////////////////////////////////////////////////////////////////////////
	// Singleton instance
	/////////////////////////////////////////////////////////////////
	static LPTA_D3D_CONFIG _d3dConfig;
	LptaD3DConfig(const LPDIRECT3D9 d3d);

	///////////////////////////////////////////////////////////////////////////
	// User dialog helper methods
	/////////////////////////////////////////////////////////////////
	void UpdateAdapterOptions(void) const;

	///////////////////////////////////////////////////////////////////////////
	//
	/////////////////////////////////////////////////////////////////
	vector<D3DFORMAT> displayFormats;
	vector<AdapterInfo> adapterInfos;

	///////////////////////////////////////////////////////////////////////////
	// Dialog specific attributes
	/////////////////////////////////////////////////////////////////
	HWND fullscreenToggle;
	HWND windowedToggle;
	HWND adapterSelection;
	HWND backBufferSelection;
	HWND modeSelection;
	HWND formatSelection;
	HWND deviceSelection;
};

#endif